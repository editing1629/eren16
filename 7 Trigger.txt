CREATE TABLE Library (
    bno NUMBER(5) PRIMARY KEY,
    bookname VARCHAR2(30),
    allowed_days NUMBER(3)
)


CREATE TABLE Library_Audit (
    bno NUMBER(5),
    bookname VARCHAR2(30),
    allowed_days NUMBER(3),
    action_type VARCHAR2(10),
    action_date DATE
);


CREATE OR REPLACE TRIGGER tr_library_audit
BEFORE UPDATE OR DELETE ON Library
FOR EACH ROW
BEGIN
    IF UPDATING THEN
        INSERT INTO Library_Audit
        VALUES(:OLD.bno, :OLD.bookname, :OLD.allowed_days, 'UPDATE', SYSDATE);
    ELSIF DELETING THEN
        INSERT INTO Library_Audit
        VALUES(:OLD.bno, :OLD.bookname, :OLD.allowed_days, 'DELETE', SYSDATE);
    END IF;
END;
/

INSERT INTO Library VALUES(101, 'DBMS', 15);


INSERT INTO Library VALUES(102, 'Operating System', 10);


COMMIT;


UPDATE Library SET allowed_days = 20 WHERE bno = 101;


DELETE FROM Library WHERE bno = 102;


SELECT * FROM Library_Audit;

